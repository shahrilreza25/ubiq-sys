var OPENPLATFORM={};OPENPLATFORM.version='2.0.0',OPENPLATFORM.callbacks={},OPENPLATFORM.events={},OPENPLATFORM.is=top!==window,OPENPLATFORM.init=function(n){if(n||(n=function(n){!0!==n&&(document.body.innerHTML='401: Unauthorized',setTimeout(function(){window.close()},2e3))}),OPENPLATFORM.is){for(var e=location.search.substring(1).split('&'),t=null,o=0,r=e.length;o<r;o++){var i=e[o];if('openplatform='===i.substring(0,13)){t=decodeURIComponent(i.substring(13));break}}var O={};O.ua=navigator.userAgent,OPENPLATFORM.accesstoken=t;var P=setTimeout(function(){P=null,n('timeout')},1500);OPENPLATFORM.send('verify',O,function(e,t){P&&(clearTimeout(P),n(null,t,setTimeout(function(){t.href&&(location.href=t.href)},100))),P=null})}else n(new Error('OpenPlatform isn\'t detected.'))},OPENPLATFORM.loading=function(n){return OPENPLATFORM.send('loading',n)},OPENPLATFORM.message=function(n,e){var t={};return t.body=n,t.type=e,OPENPLATFORM.send('message',t)},OPENPLATFORM.meta=function(n){var e={};e.ua=navigator.userAgent,e.accesstoken=OPENPLATFORM.accesstoken,OPENPLATFORM.send('meta',e,function(e,t){n(e,t)})},OPENPLATFORM.play=function(n){return OPENPLATFORM.send('play',n)},OPENPLATFORM.stop=function(n){return OPENPLATFORM.send('stop',n)},OPENPLATFORM.maximize=function(n){return OPENPLATFORM.send('maximize',n)},OPENPLATFORM.restart=function(){return OPENPLATFORM.send('restart',location.href)},OPENPLATFORM.open=function(n,e){return OPENPLATFORM.send('open',{id:n,data:e})},OPENPLATFORM.minimize=function(){return OPENPLATFORM.send('minimize')},OPENPLATFORM.close=function(){return OPENPLATFORM.send('kill')},OPENPLATFORM.notify=function(n,e,t){return'string'==typeof n&&(t=e,e=n,n=0),OPENPLATFORM.send('notify',{type:n,body:e,url:t||'',datecreated:new Date})},OPENPLATFORM.send=function(n,e,t){'function'==typeof e&&(t=e,e=null);var o={};if(o.openplatform=!0,o.accesstoken=OPENPLATFORM.accesstoken,o.type=n,o.body=e||null,o.sender=!0,o.origin=location.origin,top)return t&&(o.callback=(1e6*Math.random()).toString(32).replace(/\./g,''),OPENPLATFORM.callbacks[o.callback]=t),top.postMessage(JSON.stringify(o),'*'),OPENPLATFORM;t&&t(new Error('The application is not runned in the openplatform scope.'))},OPENPLATFORM.on=function(n,e){return OPENPLATFORM.events[n]||(OPENPLATFORM.events[n]=[]),OPENPLATFORM.events[n].push(e),OPENPLATFORM},window.addEventListener('message',function(n){try{var e=JSON.parse(n.data);if(!e.openplatform)return;if(e.callback){var t=OPENPLATFORM.callbacks[e.callback];return void(t&&(e.sender&&(e.error=new Error('The application is not running in the OpenPlatform scope.')),t(e.error,e.body||{}),delete OPENPLATFORM.callbacks[e.callback]))}if(e.sender)return;if('redirect'===e.type)return void(location.href=e.body);'kill'===e.type&&(e.type='close');var o=OPENPLATFORM.events[e.type];o&&o.forEach(function(n){n(e.body||{})})}catch(n){}},!1);